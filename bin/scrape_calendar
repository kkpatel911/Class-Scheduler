#! /app/.heroku/node/bin/node
async function scrape_calendar() {
    const dataTier = require("../lib/dataTier");
    const scraper = require("../lib/scrapper");
    const utils = require("../lib/utils");
    // Find term
    var term = utils.getTerm()

    // If a subject has a term earlier than current term, scrape
    var dirtySubject = await dataTier.getSubjectWithPreviousTerm(term)
    while(dirtySubject != null && dirtySubject != undefined) {
        console.log(term)
        console.log(dirtySubject)
        // Remove pre-existing classes in this subject in this term (so we won't have duplicates)
        await dataTier.clearClassDataBySubjectInTerm(dirtySubject, term)
        // Scrape data by subject and term
        await scraper.scrapeData(dirtySubject, term)
        // Delete date from that subject with old term
        await dataTier.clearClassDataBySubjectAndTerm(dirtySubject, term)
        var dirtySubject = await dataTier.getSubjectWithPreviousTerm(term)
    }
    // Double-check for subjects that don't have any classes
    await scraper.scrapeUnusedClasses(term)
    process.exit();
}

scrape_calendar();